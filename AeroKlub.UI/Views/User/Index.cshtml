@model AeroKlub.UI.Models.PlaneListViewModel
@using System.Globalization
@{
	Layout = null;
}

<!DOCTYPE html>

<html>
<head>
	<meta name="viewport" content="width=device-width" />


	<title>Index</title>

	<link href="~/css/nouislider.css" rel="stylesheet" />
	<script src="~/Scripts/nouislider.js"></script>
	<link href="~/css/nouislider.min.css" rel="stylesheet" />
	<script src="~/Scripts/nouislider.min.js"></script>
	<script src="~/Scripts/wNumb.js"></script>

	<link href="~/Content/bootstrap.min.css" rel="stylesheet" />
	<script src="~/Scripts/jquery-3.3.1.min.js"></script>
	<script src="~/Scripts/bootstrap.min.js"></script>

	<style>
		table, th, td {
			border: 2px solid black;
			padding: 10px;
		}

		td {
			position: relative;
		}

		.noUi-tooltip {
			display: none;
		}

		.noUi-active .noUi-tooltip {
			display: block;
		}

		.modal-header {
			display: block;
		}

		body {
			padding-top: 70px;
		}

		.col-centered {
			margin: 0 auto;
			float: none;
		}
		.noUi-handle {
			outline: none;
		}
	</style>

</head>
<body>

	@if (TempData["message"] != null)
	{
		<script src="~/Scripts/bootbox.min.js"></script>
		<script src="~/Scripts/bootbox.js"></script>

		<script>

				bootbox.alert({
					size: "small",
					title: "Rezerwacja",
					message: '@TempData["message"]'
			})

		</script>

	}

	<nav class="navbar fixed-top navbar-expand-lg navbar-light bg-light">
		<a class="navbar-brand">Areo Klub</a>

		<div class="collapse navbar-collapse" id="navbarNav">
			<ul class="navbar-nav">
				<li class="nav-item">
					@Html.ActionLink("Home", "Index", "User", new { Name = Model.Name, NickName = Model.NickName }, new { @class = "nav-link" })
				</li>
				<li class="nav-item">
					@Html.ActionLink("Twoje rezerwacje", "GetHisReservations", "User", new { Name = Model.Name, NickName = Model.NickName }, new { @class = "nav-link" })
				</li>
				<li class="nav-item">
					@Html.ActionLink("Wyloguj", "Login", "Login", null, new { @class = "nav-link" })
				</li>
			</ul>
		</div>
	</nav>
	<div class="container-fluid text-center">

		@if (Model.Samoloty == null && Model.PlaneName == null)
		{

			using (Html.BeginForm("SerchPlane", "User", FormMethod.Post, new { enctype = "multipart/form-data" }))
			{
				<h3 style="padding-bottom:1%;">Wybierz odpowiedni samolot , dla którego chcesz wykonać rezerwacje: </h3>

				@Html.DropDownList("PlaneName", Model.ListaSamolotów, new { @class = "form-control col-centered", @style = "width:20%" })
				@Html.TextBox("Name", Model.Name, new { @readonly = true, @style = "display:none" })
				@Html.TextBox("NickName", Model.NickName, new { @readonly = true, @style = "display:none" })

				<input type="submit" value="Szukaj" class="btn btn-info" style="margin-top:2%" />

			}

			<div style="padding-top: 1%">
				@Html.ActionLink("Wyświetl wszystko", "Index", new { all = true, Name = Model.Name, NickName = Model.NickName }, new { @class = "btn btn-primary" })
			</div>


		}
		else if (Model.PlaneName != null)
		{
			<h2 style="text-align:center; margin: 0 0 15px 0">Rozkład lotów dla @Model.Name</h2>
			<table style="margin: 10px;" class="table text-center">
				<thead class="thead-dark ">
					<tr>
						<th>
							Nazwa
						</th>
						@for (int i = 0; i <= 6; i++)
						{
							<th>
								@DateTime.Now.AddDays(i).ToShortDateString()
							</th>
						}
					</tr>
				</thead>
				@{int z = 0; }
				<tbody>

					<tr>
						<td class="align-middle">@Model.PlaneName</td>

						@for (int i = 0; i <= 6; i++)
						{
							z = z + 1;
							bool isService = false;

							foreach (var service in Model.Serwis)
							{
								if (Model.PlaneName == service.Samolot && DateTime.ParseExact(service.Data, "dd.MM.yyyy", CultureInfo.InvariantCulture) == DateTime.Now.Date.AddDays(i))
								{
									isService = true;
								}
							}


							<td class="align-middle">
								@if (isService == false)
								{
									@Html.Action("Rezerwacja", "Reservation", new { PlaneName = Model.PlaneName, Date = DateTime.Now.AddDays(i).ToShortDateString(), Name = Model.Name, Number = z, By = Model.Name, NickName = Model.NickName , All = false})
									@Html.Action("GetReservation", new { name = Model.PlaneName, data = DateTime.Now.AddDays(i).ToShortDateString(), username = Model.Name })
								}
								else
								{
									<div>Brak możliwości rezerwacji z powodu serwisu samolotu!</div>
								}
							</td>
						}

					</tr>

				</tbody>
			</table>

			<div class="text-center" style="padding-top:1%">
				<div>
					@Html.ActionLink("Wyświetl wszystko", "Index", new { all = true, Name = Model.Name, NickName = Model.NickName }, new { @class = "btn btn-primary" })
				</div>
				<div style="padding-top:1%">
					@Html.ActionLink("Znajdz samolot", "Index", new { all = false, Name = Model.Name, NickName = Model.NickName }, new { @class = "btn btn-primary" })
				</div>
			</div>
		}

		else if (Model.Samoloty != null)
		{
			<h2 style="text-align:center; margin: 0 0 15px 0">Rozkład lotów dla @Model.Name</h2>
			<table style="margin: 10px;" class="table text-center">
				<thead class="thead-dark ">
					<tr>
						<th>
							Nazwa
						</th>
						@for (int i = 0; i <= 6; i++)
						{
							<th>
								@DateTime.Now.AddDays(i).ToShortDateString()
							</th>
						}
					</tr>
				</thead>
				@{int z = 0; }
				<tbody>
					@foreach (var Samolot in Model.Samoloty)
					{
						z = z + 1;

						<tr>
							<td class="align-middle">@Samolot.Nazwa</td>

							@for (int i = 0; i <= 6; i++)
							{
								z = z + 1;
								bool isService = false;

								foreach (var service in Model.Serwis)
								{
									if (Samolot.Nazwa == service.Samolot && DateTime.ParseExact(service.Data, "dd.MM.yyyy", CultureInfo.InvariantCulture) == DateTime.Now.Date.AddDays(i))
									{
										isService = true;
									}
								}


								<td class="align-middle">
									@if (isService == false)
									{
										@Html.Action("Rezerwacja", "Reservation", new { PlaneName = Samolot.Nazwa, Date = DateTime.Now.AddDays(i).ToShortDateString(), Name = Model.Name, Number = z, By = Model.Name, NickName = Model.NickName , All = true })
										@Html.Action("GetReservation", new { name = Samolot.Nazwa, data = DateTime.Now.AddDays(i).ToShortDateString(), username = Model.Name })
									}
									else
									{
										<div>Brak możliwości rezerwacji z powodu serwisu samolotu!</div>
									}
								</td>
							}

						</tr>

					}
				</tbody>
			</table>

			<div style="padding-top:1%">
				@Html.ActionLink("Znajdz samolot", "Index", new { all = false, Name = Model.Name, NickName = Model.NickName }, new { @class = "btn btn-primary" })
			</div>
		}
	</div>
</body>
</html>
